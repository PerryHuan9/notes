# 平面编辑器

## 项目背景
平面编辑器作为底层SDK为海报编辑器、图片编辑器、H5编辑器和PPT编辑器提供支持。
* 海报编辑器是为生产海报的工具的，它产物是图片。
* 图片编辑器用于图片编辑，它的产物也是图片。
* H5编辑器用于编辑H5，产物是HTML。
* PPT编辑器则是用于制作PPT演讲稿，它的产物是PPT文件。
它作为底层框架，实际提供了两大能力，数据编辑能力和数据渲染能力。

## 编辑能力
如何编辑平面编辑器的数据？我们首先要搞清楚，平面编辑器的数据是什么，它的数据本质上描述了一块区域的视图组成，包括这块区域的大小，背景颜色，以及这块区域包含什么样的内容。我们自然而然地想到：定义不同类型的元素，如文字、图片、视频、线条、表格等等。这些元素都有一些公共的数据模型，比如宽高，图层顺序；也具备拖动和缩放的基础能力。然后为不同元素增加修改它们的交互，比如svg元素是具备修改各个部分能力的交互的。

当我们将这些元素照对应的图层以及宽高渲染到画布，用户也就可以通过选中某个元素，然后针对它进行修改，这本质上是对平面数据进行了修改。

## 渲染能力
用户通过编辑器完成了对数据的编辑，但用户还需要拿到他的产物，当在图片和海报编辑器，用户希望拿到图片；而在H5编辑器时，用户需要拿到HTML；最后在PPT编辑器中时用户想拿到的是PPT文件。所以我们还需要将平面的视图数据渲染成对应的产物。当需要图片时，将视图数据渲染到`canvas`上，然后通过canvas输出HTML，当需要HTML时，将数据渲染成HTML，当需要PPPT时，将数据渲染到PPT上。这些的实质是完成一个个针对不同产物的渲染器，通过渲染器得到相对应的渲染产物。


## 亮点
我认为这种将视图当做数据，然后通过编辑器编辑数据，最后将数据渲染到不同的文档中的架构就是最大的亮点。在这种架构下，无论上层业务编辑器需要的是什么产物，编辑数据的SDK都是不需要做出改变，仅仅需要实现一个对应文档的渲染器而已。


## 难点
即便我把这个详细说得如何简单，但必须承认它是一个很复杂的项目。
1. 每一个元素的实现都异常繁琐，比如table元素，他需要有增加行列等等交互，而且它不是单一样式，还需要提供针对表格的各种属性的修改。
2. 渲染器的实现非常复杂，就渲染到canvas而言，但数据中包含gif或者apng动图时，这对合成还造成很大的困难，当动图帧数很多时，非常容器出现性能问题。
3. 业务及其复杂，除了上面所说的几个编辑器之外，我们还有各个编辑器的企业版，还有SDK，这些编辑器在大部分功能是一致的，但是在一些地方上还是存在差异，这对代码代码管理又提出了新的难点。

























