## 微信编辑器
通过`prosemirror`只是构建了一个基础的文档编辑器，而我们还需要编辑器承载我们的内容，即素材，一个标题素材是通过标题块来实现，它可能有许多装饰，背景图片或者边框。

### 渲染层实现
前面说了，定义块的时候需要提供一个`toDom`方法，来将块转成对应的`html`结构，我们可以将块转成任意`html`结构，然后装饰可以通过绝对定位来实现，边框背景可以通过`border-image`来实现。但遗憾的是，微信公众号不支持绝对定位，也不支持边框背景。我们只能通过另外的手段来实现这些功能，我们通过九宫格来实现了边框背景，通过了`margin`负值以及`transform`的手段实现装饰元素的偏移，总的来说就是实现了渲染层，引入`box-style`的概念，有普通背景类型的`box-style`,有装饰类型的`boy-style`， 智能拉伸类型`boy-style`，还有反向拉伸的`box-style`。将数据传给渲染层，就可以渲染出设计稿对应的素材。


### 生产工具
前文说到我们实现了渲染层，用来还原素材，但我们不可能人工还原设计师提供设计稿，这样效率是极其低下的，那么应该怎么将设计师提供的`PSD`转化成我们渲染层支持的数据结构？早期我们的想法是通过对`psd`打标签，在不同图层，不同目录通过名字来表明它是什么类似的渲染层元素，即是装饰元素还是背景，这样在转换的时候就可以根据这些标签来转化成我们对应的素材。但这种打标签的方式对设计师实在是太不友好了，所以后面我们决定提供一个生产工具，在生产编辑器中，设计师先上传`psd`，我们将`psd`解析成平面元素，然后再让设计师决定将这些元素转化成什么样的素材。


### 组合素材
除了基础的块，如标题，图片，重点文本之类，我们还提供了组合块，允许将多个基础块组合到一起，如主副标题，图片卡片，文字卡片等等。早期我们采用了一套有限制的方案，即某个确定的组合块只能放固定的基础块，并且它的顺序也是定义好的。但是后面觉得这套方案对用户不太友好，比如用户想在我们组合块里面增加其它的内容，结果它发现加不进来。所以后面改用一套没有限制的方案，我们实现了一个flexbox块作为容器，使用这个容器组织基础块，就实现了不同的组合块。组合块加上了样式就能实现组合素材。组合块还有另外一个目的，当用户选中多个块时，我们可以从素材库匹配筛选出允许转换的组合素材，这样用户的写作效率能得到进一步提高。


