# 同构应用
什么是同构？在解释这个之前先了解一下SSR，所谓SSR就是服务端渲染，在服务端就请求数据，渲染到文档中，这样子浏览器端拿到的就是完整的`html`。服务端有两个优势：首先，加快首屏加载速度；其次，对SEO提供支持。单纯的SSR使用`java`、`php`等等都可以实现，这不是我们的目标。我们的目标是兼有`SSR`和`SPA`的优点，使其既能实现`SSR`,在浏览器端跳转时，又能享受`SPA`无需刷新页面的体验。这种兼有`SSR`和`SPA`优点，并且最大程度实现服务端和浏览器端代码复用的应用就叫同构应用。那要怎么实现同构应用？


## 实现`SSR`
同构应用要具备`SPA`的优点，那必然要使用框架，`Vue`或`React`框架都是可以的，这里我们以`React`举例。 我们都知道`react jsx`会被编译成`js`，最终会输出`virtual dom`对象，`virtual dom`是一种描述`html dom`的对象，或者说`virtual dom`就是一种数据，我们自然而然能够将`virtual dom`转换为`html`字符串，  `React`也提供了`React.renderToString()`方法，允许我们将`react element`转换为`html`字符串。有了这个接口，我们可以搭建一个`node`服务，在响应请求时，根据请求的路由找到对应`react component`,然后请求在这个路由下需要的数据， 然后使用`React.renderToString()`将这个组件和数据渲染`html`字符串返回，这样子浏览器就能拿到页面的完整`html`。可是我们发现一个问题，浏览器接受的是`html`字符串，它要怎么在本地实现`SPA`呢？

## 实现同构
`SSR`返回的是纯`html`字符串，也就是说到了客户端仅仅是把页面渲染出来，而无法与用户进行交互。需要指出的是，在返回html字符串时，我们还是把`react`应用的入口js文件以及请求的数据返回给浏览器端，以使浏览器端能重新构建react应用。回归正题，要实现与用户的交互，我们还需要完成事件的绑定，将其恢复为`React`应用。`React`还提供了`React.hydrate()`方法，用于比对`html`和`react`组件，好将其恢复为react应用。为什么要`hydrate`，而不是直接替换服务端返回的字符串？直接替换已经渲染好的服务端的html字符串页面会闪烁一下，这显然是不好的交互，所以我们选择在已经渲染好html dom恢复react 应用。




